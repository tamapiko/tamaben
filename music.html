<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Piano</title>
    <style>
        .piano { display: flex; }
        .key { width: 50px; height: 200px; border: 1px solid black; }
        .white { background-color: white; }
        .black { width: 30px; height: 150px; position: relative; left: -15px; background-color: black; z-index: 1; }
        .key:active { background-color: yellow; }
    </style>
</head>
<body>

<div class="piano">
    <!-- White keys -->
    <div class="key white" id="C" onclick="playKey(0)"></div>
    <div class="key white" id="D" onclick="playKey(2)"></div>
    <div class="key white" id="E" onclick="playKey(4)"></div>
    <div class="key white" id="F" onclick="playKey(5)"></div>
    <div class="key white" id="G" onclick="playKey(7)"></div>
    <div class="key white" id="A" onclick="playKey(9)"></div>
    <div class="key white" id="B" onclick="playKey(11)"></div>

    <!-- Black keys -->
    <div class="key black" id="C#" onclick="playKey(1)"></div>
    <div class="key black" id="D#" onclick="playKey(3)"></div>
    <div class="key black" id="F#" onclick="playKey(6)"></div>
    <div class="key black" id="G#" onclick="playKey(8)"></div>
    <div class="key black" id="A#" onclick="playKey(10)"></div>
</div>

<script>
// 音を鳴らす関数
function 音を鳴らす(音声ファイル名) {
    console.log(`${音声ファイル名}の音を鳴らす`);
    const audio = new Audio(音声ファイル名);
    audio.play();
}

// CV関数に基づいたキーの音を鳴らす
function CV(音名, oct調整, 拍数) {
    let 拍待ちカウント = 拍数;
    console.log(`拍待ちカウントを${拍数}ずつ変える`);

    let ピッチ = 音名 * Math.pow(2, oct調整 + 5 + 12 * (10 + 688));
    console.log(`ピッチ: ${ピッチ}`);

    let 音階 = (音名 * Math.pow(2, oct調整 + 5 + 12 * (10 + 688))) % 12 + 1;
    console.log(`${音階}番目`);

    const テンポ = 60;
    if (0.469 * Math.pow(2, -0.005 * ピッチ) < Math.exp(拍数 / 60 / テンポ)) {
        音を鳴らす("4.mp3");
    } else if (0.292 * Math.pow(2, -0.005 * ピッチ) < Math.exp(拍数 / 60 / テンポ)) {
        音を鳴らす("6.mp3");
    } else if (0.251 * Math.pow(2, -0.0045 * ピッチ) < Math.exp(拍数 / 60 / テンポ)) {
        音を鳴らす("8.mp3");
    } else {
        音を鳴らす("16.mp3");
    }

    console.log(`${拍数 - 0.08}拍休む`);
}

// クリックされたキーに基づいて音を鳴らす
function playKey(音名) {
    CV(音名, 0, 4);
}
</script>

</body>
</html>

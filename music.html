<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ピアノと猫ボイス</title>
    <script src="https://cdn.jsdelivr.net/npm/vexflow/releases/3.0.9/vexflow-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/midi.js"></script>
</head>
<body>
    <div id="score"></div>
    <button onclick="playScore()">楽譜を再生</button>
    <audio id="cat-sound" src="Meow.mp3" preload="auto"></audio>

    <script>
        // MIDIの初期化
        MIDI.loadPlugin({
            soundfontUrl: "./soundfonts/",
            instrument: "acoustic_grand_piano",
            onsuccess: function() {
                console.log("MIDI plugin loaded");
            }
        });

        // VexFlowを使って楽譜を描画
        const VF = Vex.Flow;
        const div = document.getElementById("score");
        const renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);
        
        renderer.resize(500, 200);
        const context = renderer.getContext();
        const stave = new VF.Stave(10, 40, 400);
        stave.addClef("treble").addTimeSignature("4/4");
        stave.setContext(context).draw();

        // 楽譜のノートを設定
        const notes = [
            new VF.StaveNote({ keys: ["c/4"], duration: "q" }),  // C
            new VF.StaveNote({ keys: ["d/4"], duration: "q" }),  // D
            new VF.StaveNote({ keys: ["e/4"], duration: "q" }),  // E
            new VF.StaveNote({ keys: ["f/4"], duration: "q" })   // F
        ];

        // ボイスを作成してノートを追加
        const voice = new VF.Voice({ num_beats: 4, beat_value: 4 });
        voice.addTickables(notes);

        const formatter = new VF.Formatter().joinVoices([voice]).format([voice], 300);
        voice.draw(context, stave);

        // 楽譜を再生する関数
        function playScore() {
            // C、D、E、FをMIDIで再生
            MIDI.noteOn(0, 60, 127, 0);  // C
            MIDI.noteOff(0, 60, 0.75);    // Cの音を0.75秒後に止める
            playCatSound(); // 猫の鳴き声再生

            MIDI.noteOn(0, 62, 127, 1);  // D
            MIDI.noteOff(0, 62, 1.75);   // Dの音を1.75秒後に止める
            playCatSound(); // 猫の鳴き声再生

            MIDI.noteOn(0, 64, 127, 2);  // E
            MIDI.noteOff(0, 64, 2.75);   // Eの音を2.75秒後に止める
            playCatSound(); // 猫の鳴き声再生

            MIDI.noteOn(0, 65, 127, 3);  // F
            MIDI.noteOff(0, 65, 3.75);   // Fの音を3.75秒後に止める
            playCatSound(); // 猫の鳴き声再生
        }

        // 猫の鳴き声を再生する関数
        function playCatSound() {
            const audio = document.getElementById('cat-sound');
            audio.currentTime = 0;  // 音声を最初から再生
            audio.play();
        }
    </script>
</body>
</html>
